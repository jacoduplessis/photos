var Photos=function(){"use strict";function t(){}function e(t){for(var e,n,o=1,i=arguments.length;o<i;o++){n=arguments[o];for(e in n)t[e]=n[e]}return t}function n(t,e){e.appendChild(t)}function o(t,e,n){e.insertBefore(t,n)}function i(t){t.parentNode.removeChild(t)}function r(t){for(var e=0;e<t.length;e+=1)t[e]&&t[e].d()}function s(t){return document.createElement(t)}function a(t){return document.createTextNode(t)}function c(){return document.createComment("")}function h(t,e,n){t.addEventListener(e,n,!1)}function u(t,e,n){t.removeEventListener(e,n,!1)}function f(t,e,n){t.setAttribute(e,n)}function l(t,e,n){t.style.setProperty(e,n)}function p(){return Object.create(null)}function _(e){this.destroy=t,this.fire("destroy"),this.set=this.get=t,!1!==e&&this._fragment.u(),this._fragment.d(),this._fragment=this._state=null}function g(t,e){return t!==e||t&&"object"==typeof t||"function"==typeof t}function d(t,e,n,o,i){for(var r in e)if(n[r]){var s=o[r],a=i[r],c=e[r];if(c)for(var h=0;h<c.length;h+=1){var u=c[h];u.__calling||(u.__calling=!0,u.call(t,s,a),u.__calling=!1)}}}function v(t,e){t.options=e,t._observers={pre:p(),post:p()},t._handlers=p(),t._root=e._root||t,t._yield=e._yield,t._bind=e._bind}function m(t){for(;t&&t.length;)t.pop()()}function b(t,e){return 0!==e&&t<e}function y(){return{api_key:"",user_id:"",filters:{},photos:[],loading:!1,showFilters:!1,total:0,page:1,pages:1}}function k(t){f(t,"svelte-2824415533","")}function N(t,e){for(var n,h,u,f,l=t.loading&&x(t,e),p=t.photos,_=[],g=0;g<p.length;g+=1)_[g]=P(t,p,p[g],g,e);var d=t.hasNextPage&&j(t,e);return{c:function(){l&&l.c(),n=a("\n"),h=s("div");for(var t=0;t<_.length;t+=1)_[t].c();u=a("\n"),d&&d.c(),f=c(),this.h()},h:function(){k(h),h.className="photos"},m:function(t,e){l&&l.m(t,e),o(n,t,e),o(h,t,e);for(var i=0;i<_.length;i+=1)_[i].m(h,null);o(u,t,e),d&&d.m(t,e),o(f,t,e)},p:function(t,o){o.loading?l||((l=x(o,e)).c(),l.m(n.parentNode,n)):l&&(l.u(),l.d(),l=null);var i=o.photos;if(t.photos){for(var r=0;r<i.length;r+=1)_[r]?_[r].p(t,o,i,i[r],r):(_[r]=P(o,i,i[r],r,e),_[r].c(),_[r].m(h,null));for(;r<_.length;r+=1)_[r].u(),_[r].d();_.length=i.length}o.hasNextPage?d?d.p(t,o):((d=j(o,e)).c(),d.m(f.parentNode,f)):d&&(d.u(),d.d(),d=null)},u:function(){l&&l.u(),i(n),i(h);for(var t=0;t<_.length;t+=1)_[t].u();i(u),d&&d.u(),i(f)},d:function(){l&&l.d(),r(_),d&&d.d()}}}function x(e,n){var r;return{c:function(){(r=s("div")).textContent="Loading...",this.h()},h:function(){k(r),r.className="loading"},m:function(t,e){o(r,t,e)},u:function(){i(r)},d:t}}function P(e,r,a,c,h){var u,l,p,_,g,d,v;return{c:function(){u=s("a"),_=s("img"),this.h()},h:function(){k(u),u.className="photo",u.href=l=a.url_l,f(u,"data-caption",p=a.title+" "+a.datetaken+" "+a.description._content),k(_),_.src=g=a.url_q,_.title=d=a.title,_.alt=v=a.title},m:function(t,e){o(u,t,e),n(_,u)},p:function(t,e,n,o,i){t.photos&&l!==(l=o.url_l)&&(u.href=l),t.photos&&p!==(p=o.title+" "+o.datetaken+" "+o.description._content)&&f(u,"data-caption",p),t.photos&&g!==(g=o.url_q)&&(_.src=g),t.photos&&d!==(d=o.title)&&(_.title=d),t.photos&&v!==(v=o.title)&&(_.alt=v)},u:function(){i(u)},d:t}}function j(t,e){function r(t){var n=e.get();e.appendPage(n.page+1)}var c,f,p,_,g,d,v,m,b=t.page+1;return{c:function(){c=s("button"),f=a("Load More ("),p=a(b),_=a(" of "),g=a(t.pages),d=a(", "),v=a(t.total),m=a(" total)"),this.h()},h:function(){k(c),l(c,"display","flex"),l(c,"margin","1rem auto"),h(c,"click",r)},m:function(t,e){o(c,t,e),n(f,c),n(p,c),n(_,c),n(g,c),n(d,c),n(v,c),n(m,c)},p:function(t,e){t.page&&b!==(b=e.page+1)&&(p.data=b),t.pages&&(g.data=e.pages),t.total&&(v.data=e.total)},u:function(){i(c)},d:function(){u(c,"click",r)}}}function O(t){v(this,t),this._state=e(y(),t.data),this._recompute({page:1,pages:1},this._state),this._fragment=N(this._state,this),t.target&&(this._fragment.c(),this._fragment.m(t.target,t.anchor||null))}return e(O.prototype,{setDeep:function(t,e){if(void 0!==t){var n=t.replace(/\[(\d+)\]/g,".$1").split("."),o=n.pop();if(void 0===n[0]){var i={};return i[o]=e,void this.set(i)}for(var r=this.get(n[0]),s=1;s<n.length;s++)r=r[n[s]];r[o]=e;var a={};a[n[0]]=this.get(n[0]),this.set(a)}},getJSON:function(t,e){var n="https://api.flickr.com/services/rest/?format=json&nojsoncallback=1";return n+="&api_key="+this.get("api_key"),n+="&method="+t,e&&Object.keys(e).forEach(function(t){n+="&"+t+"="+e[t]}),fetch(n).then(function(t){return t.json()})},appendPage:function(t){this.getPhotos({page:t},!0)},getPhotos:function(t,e){var n=this;this.set({loading:!0});var o={user_id:this.get("user_id"),extras:"views,url_sq,url_t,url_s,url_q,url_m,url_l,geo,tags,description,date_taken,machine_tags"},i=Object.assign({},o,this.get("filters"),t||{});this.getJSON("flickr.photos.search",i).then(function(t){var o=t.photos.photo,i=e?n.get("photos").concat(o):o;n.set({photos:i,pages:t.photos.pages,total:t.photos.total,page:t.photos.page,loading:!1})})}},{destroy:_,get:function(t){return t?this._state[t]:this._state},fire:function(t,e){var n=t in this._handlers&&this._handlers[t].slice();if(n)for(var o=0;o<n.length;o+=1)n[o].call(this,e)},observe:function(t,e,n){var o=n&&n.defer?this._observers.post:this._observers.pre;return(o[t]||(o[t]=[])).push(e),n&&!1===n.init||(e.__calling=!0,e.call(this,this._state[t]),e.__calling=!1),{cancel:function(){var n=o[t].indexOf(e);~n&&o[t].splice(n,1)}}},on:function(t,e){if("teardown"===t)return this.on("destroy",e);var n=this._handlers[t]||(this._handlers[t]=[]);return n.push(e),{cancel:function(){var t=n.indexOf(e);~t&&n.splice(t,1)}}},set:function(t){this._set(e({},t)),this._root._lock||(this._root._lock=!0,m(this._root._beforecreate),m(this._root._oncreate),m(this._root._aftercreate),this._root._lock=!1)},teardown:_,_recompute:t,_set:function(t){var n=this._state,o={},i=!1;for(var r in t)g(t[r],n[r])&&(o[r]=i=!0);i&&(this._state=e({},n,t),this._recompute(o,this._state),this._bind&&this._bind(o,this._state),d(this,this._observers.pre,o,this._state,n),this._fragment.p(o,this._state),d(this,this._observers.post,o,this._state,n))},_mount:function(t,e){this._fragment.m(t,e)},_unmount:function(){this._fragment.u()}}),O.prototype._recompute=function(t,e){(t.page||t.pages)&&g(e.hasNextPage,e.hasNextPage=b(e.page,e.pages))&&(t.hasNextPage=!0)},O}();
